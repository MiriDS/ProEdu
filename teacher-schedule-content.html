<div class="col-xl-12">
    <ul class="weekly">
        <li day="1">
            <div class="card">
                <div class="card-body">
                    <div class="name">
                        Bazar ertəsi
                        <!--<span class="badge badge-primary ml-1">3</span>-->
                    </div>
                    <span class="date"></span>
                </div>
            </div>
        </li>
        <li day="2">
            <div class="card">
                <div class="card-body">
                    <div class="name">
                        Çərşənbə axşamı
                        <!--<span class="badge badge-primary ml-1">3</span>-->
                    </div>
                    <span class="date"></span>
                </div>
            </div>
        </li>
        <li day="3">
            <div class="card">
                <div class="card-body">
                    <div class="name">
                        Çərşənbə
                        <!--<span class="badge badge-primary ml-1">3</span>-->
                    </div>
                    <span class="date"></span>
                </div>
            </div>
        </li>
        <li day="4">
            <div class="card">
                <div class="card-body">
                    <div class="name">
                        Cümə axşamı
                        <!--<span class="badge badge-primary ml-1">0</span>-->
                    </div>
                    <span class="date"></span>
                </div>
            </div>
        </li>
        <li day="5">
            <div class="card">
                <div class="card-body">
                    <div class="name">
                        Cümə
                        <!--<span class="badge badge-primary ml-1">0</span>-->
                    </div>
                    <span class="date"></span>
                </div>
            </div>
        </li>
        <li day="6">
            <div class="card">
                <div class="card-body">
                    <div class="name">
                        Şənbə
                        <!--<span class="badge badge-primary ml-1">2</span>-->
                    </div>
                    <span class="date"></span>
                </div>
            </div>
        </li>
        <li day="7">
            <div class="card">
                <div class="card-body">
                    <div class="name">
                        Bazar
                        <!--<span class="badge badge-primary ml-1">1</span>-->
                    </div>
                    <span class="date"></span>
                </div>
            </div>
        </li>
    </ul>
</div>
<div class="col-xl-12">
    <div class="card">
        <div class="card-body">
            <h5 class="header-title mb-4"><span id="selectedDate"></span> tarixinə olan dərs cədvəli.</h5>

            <div class="table-responsive">
                <table id="teacher-schedule-table" class="table table-centered table-hover mb-0">
                    <thead>
                    <tr>
                        <th scope="col">Dərs</th>
                        <th scope="col">Başlanma</th>
                        <th scope="col">Bitmə</th>
                        <th scope="col">Fənn</th>
                        <th scope="col">Sinif</th>
                        <th scope="col">Dərsə qoşul</th>
                    </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>


<script>

    var table = $('#teacher-schedule-table');
    var groupApiRoute = "teacher-dashboard";
    var teacherScheduleCache = {};
    function getTeacherLessons(day) {


        if(typeof teacherScheduleCache[day] == 'undefined') {

            table.append(loadingHtml);
            standartRequest(requestType.get,groupApiRoute+'/'+day,'', function(data) {
                teacherScheduleCache[day] = data;
                initTable(data);
                $('#loadingHtml').remove();
            });
        }
        else {
            initTable(teacherScheduleCache[day]);
        }


    }

    function initTable(data) {

        table.find('tbody').html('');
        for(var n in data) {
            table.find('tbody').append('<tr row_id="'+data[n].id+'"><th scope="row">'+(parseInt(n)+1)+'</th><td>'+(data[n].startsAt)+'</td><td>'+(data[n].endsAt)+'</td><td>'+_.escape(data[n].name)+'</td><td>'+(_.escape(data[n].groupNumber)+' '+_.escape(data[n].groupName))+'</td><td><button type="button" class="btn btn-outline-secondary btn-sm join_meeting" data-toggle="tooltip" data-placement="top" title="Online dərsə keçid al"><i class="mdi mdi-camera"></i></button></td></tr>');
        }
    }


    $("li[day]").click(function() {

        var day = $(this).attr('day');
        var date = $(this).find('.date').text();

        if($(this).hasClass('selected'))
            return;

        $("li[day].selected").removeClass('selected');
        $(this).addClass('selected');

        $("#selectedDate").text(date);

        getTeacherLessons(day);

    });

    var weekDays = getCurrentWeekDays();
    for(var n in weekDays) {

        $('li[day="'+(parseInt(n)+1)+'"]').find('.date').text(weekDays[n].format('DD.MM.YYYY'));
    }


    table.on('click','.join_meeting',function () {

        var row_id = $(this).closest('[row_id]').attr('row_id');
        standartRequest(requestType.get,'meeting/create-and-join/'+row_id,'',function (data) {
            window.open(data);
        });
    });

    $("li[day]").first().click();
    $("#activeModuleName").text("Dərs cədvəli");


</script>